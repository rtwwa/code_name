import{h as x}from"./kaplay-CpR_OpMc.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();function p(e){const n=document.querySelector("canvas"),i=window.innerWidth,t=window.innerHeight,o=Math.floor(i/e.width),s=Math.floor(t/e.height),r=Math.max(1,Math.min(o,s));n.style.width=e.width*r+"px",n.style.height=e.height*r+"px",n.style.imageRendering="pixelated",n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)"}function M(){const e=document.querySelector("canvas");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function S(e){window.addEventListener("resize",p(e)),window.addEventListener("load",p(e)),document.addEventListener("keydown",n=>{n.key==="f"&&M()})}const P=800,I=450,u={kaplayInstance:null,currentScene:null,init(e){this.kaplayInstance=e},addScene(e,n){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(e,n)},startScene(e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=e,this.kaplayInstance.go(e)}};function D(e,n){let i=Math.PI/2,t=0;const o=.007,s=.995;let r=null;function y(a){r=a;const l=r.pos.x-e.x,d=r.pos.y-e.y;i=Math.atan2(d,l),t=0}function g(a){t+=a}onCollide("player","solid",()=>{t=-t*2});function m(a){if(!r)return;const l=a()*60;t+=o*Math.cos(i)*l,t*=Math.pow(s,l),i+=t*l,r.pos.x=e.x+n*Math.cos(i),r.pos.y=e.y+n*Math.sin(i),r.vel.x=-n*t*Math.sin(i)*l,r.vel.y=n*t*Math.cos(i)*l}function w(){r&&drawLine({p1:e,p2:r.pos,width:2,color:[0,0,0]})}function v(a){if(e=a,r){const l=r.pos.x-e.x,d=r.pos.y-e.y;i=Math.atan2(d,l),t=0}}return{attach:y,applyImpulse:g,update:m,setAnchor:v,draw:w}}const f=500,b=-600,h=200,E=7,k=()=>{loadSprite("hero_afk","./sprites/hero-afk.png",{sliceX:8,sliceY:1,anims:{afk:0,idle:{from:0,to:7,loop:!0}}});const e=add([sprite("hero_afk"),pos(center()),area(),body(),anchor("center"),color(0,0,0),"player"]);e.play("idle"),console.log(getSprite("hero_afk")),e.lastDirection=Vec2.fromAngle(-45),onKeyDown("left",()=>{e.flipX=!0,e.move(-h,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(h,0),e.lastDirection=1}),onKeyPress("space",()=>{e.isGrounded()&&e.applyImpulse(vec2(0,b))}),onKeyPress("x",()=>{e.applyImpulse(vec2(f,0))}),onKeyPress("z",()=>{e.applyImpulse(vec2(-f,0))}),e.onUpdate(()=>{(e.vel.x>=1||e.vel.x<=-1)&&(e.lastDirection=e.vel.x,console.log(e.lastDirection)),e.isGrounded()?e.drag=E:e.drag=0}),e.onCollide("solid",()=>{console.log("collide!"),shake(5),e.vel=vec2(e.vel.x*-1,e.vel.y)});function n(){let t=!1;const o=D(vec2(0,0),120);o.attach(e),onKeyPress("up",()=>{const s=i();s!=null&&(o.setAnchor(s),t=!0)}),onKeyPress("down",()=>{if(t!=!0)return;t=!1;let s=e.vel.unit().scale(400);console.log(s),e.applyImpulse(s)}),onUpdate(()=>{t&&o.update(dt)}),onDraw(()=>{t&&o.draw()})}const i=()=>{let t=Vec2.fromAngle(-45);e.lastDirection>0?t.x=t.x:t.x=-t.x;let o=raycast(e.pos,t.scale(400),["player"]);return o?o.point:null};return n(),e},K=()=>{k(),add([rect(width(),20),pos(0,height()-20),area(),body({isStatic:!0})]),add([rect(width()/2,20),pos(width()/4,height()-300),area(),body({isStatic:!0}),"solid"]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),"solid"]),setGravity(1600)},c=x({background:[39,38,36],width:P,height:I,scale:1,pixelated:!0});S(c);u.init(c);u.addScene("test",K);u.startScene("test");c.onClick(()=>c.addKaboom(c.mousePos()));
//# sourceMappingURL=index-DZojd5zy.js.map
