import{h as D}from"./kaplay-CpR_OpMc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();function m(t){const e=document.querySelector("canvas"),s=window.innerWidth,i=window.innerHeight,n=Math.floor(s/t.width),r=Math.floor(i/t.height),o=Math.max(1,Math.min(n,r));e.style.width=t.width*o+"px",e.style.height=t.height*o+"px",e.style.imageRendering="pixelated",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}function E(){const t=document.querySelector("canvas");t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function I(t){window.addEventListener("resize",m(t)),window.addEventListener("load",m(t)),document.addEventListener("keydown",e=>{e.key==="f"&&E()})}const H=800,L=450,y={kaplayInstance:null,currentScene:null,init(t){this.kaplayInstance=t},addScene(t,e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(t,e)},startScene(t){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=t,this.kaplayInstance.go(t)}};function O(t,e){let s=Math.PI/2,i=0;const n=.5,r=.995;let o=null;function g(l){o=l;const a=o.pos.x-t.x,c=o.pos.y-t.y;s=Math.atan2(c,a),i=0}function S(l){i+=l}function M(l){if(!o)return;const a=l()*60;i+=n*Math.cos(s)*a,i*=Math.pow(r,a),s+=i*a;const c=o.pos.x-t.x,d=o.pos.y-t.y,u=Math.sqrt(c*c+d*d);if(u!==e){const p=c/u,h=d/u;o.pos.x=t.x+p*e,o.pos.y=t.y+h*e;const w=o.vel.x*p+o.vel.y*h;o.vel.x-=w*p,o.vel.y-=w*h}}function b(){if(!o)return;drawLine({p1:t,p2:o.pos,width:2,color:[0,0,0]});const l=o.vel.unit().scale(40),a=o.pos.add(l);drawLine({p1:o.pos,p2:a,width:2,color:BLUE})}function k(l){if(t=l,o){const a=o.pos.x-t.x,c=o.pos.y-t.y;s=Math.atan2(c,a),i=0}}function P(l){if(e=l,o){const a=o.pos.x-t.x,c=o.pos.y-t.y;s=Math.atan2(c,a),o.pos.x=t.x+Math.cos(s)*e,o.pos.y=t.y+Math.sin(s)*e;const d=Math.cos(s),u=Math.sin(s),p=o.vel.x*d+o.vel.y*u;o.vel.x-=p*d,o.vel.y-=p*u}}return{attach:g,applyImpulse:S,update:M,setAnchor:k,setRadius:P,draw:b}}const K=400,f=120;function R(t){const e=O(vec2(0,0),f);let s=!1;return e.attach(t),onKeyPress("z",()=>{if(s==!1){A(t,e),s=!0;return}s=!1,F(t)}),onUpdate(()=>{s&&e.update(dt)}),onDraw(()=>{s&&e.draw()}),{isHooked:s}}const A=(t,e)=>{const s=G(t);if(s==null)return;e.setAnchor(s);const i=s.sub(t.pos).len();i<f?e.setRadius(i):e.setRadius(f)},F=t=>{let e=Vec2.fromAngle(-45).scale(K);e.x=e.x*t.lastDirection,t.applyImpulse(e)},G=t=>{let e=Vec2.fromAngle(-45);t.lastDirection>0?e.x=e.x:e.x=-e.x;let s=raycast(t.pos,e.scale(f),["player"]);return s?s.point:null};function _(t){const e=getSprite("dust"),s=e.data.tex,i=e.data.frames[0];return add([pos(),particles({max:50,lifeTime:[.5,5],speed:[10,5],texture:s,quads:[i]},{direction:90,spread:20})])}const q=500,N=-600,x=200,U=7,V=t=>{loadSprite("hero","./sprites/all.png",{sliceX:8,sliceY:2,anims:{afk:0,idle:{from:0,to:7,loop:!0},walk:{from:8,to:14,loop:!0}}});const e=add([sprite("hero"),pos(t),area(),body(),anchor("center"),color(0,0,0),"player"]);e.lastDirection=1;let s=!1,i=null;onKeyDown("left",()=>{e.flipX=!0,e.move(-x,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(x,0),e.lastDirection=1}),onKeyPress("up",()=>{(e.isGrounded()||s)&&(n(),e.applyImpulse(vec2(0,N)))}),onKeyPress("x",()=>{o()}),e.onUpdate(()=>{if(r.isHooded&&console.log("hello"),e.isGrounded()?e.drag=U:e.drag=0,s&&i&&(e.pos=i.clone(),e.vel=vec2(0,0)),e.isGrounded())if(isKeyDown("left")||isKeyDown("right")){if(e.curAnim()=="walk")return;e.play("walk")}else{if(e.curAnim()=="idle")return;e.play("idle")}else e.play("afk")}),e.onCollide("solid",g=>{!s&&Math.abs(e.vel.x)>2&&!e.isGrounded()&&(s=!0,i=e.pos,e.vel=vec2(0,0),e.gravity=0,shake(5))}),onKeyPress("down",()=>{n()});function n(){s&&(s=!1,i=null,e.gravity=1,shake(1),e.vel=vec2(e.vel.x,-5))}const r=R(e);console.log(r),loadSprite("dust","./sprites/dust.png").then(()=>{_()});function o(){e.applyImpulse(vec2(q*e.lastDirection,0))}return e},C=()=>{V(vec2(width()/6+50,height()-200)),add([rect(width()/3,20),pos(0,height()-20),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(width()/3,20),pos(width()/3*2,height()-20),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(width()/3,20),pos(width()/6,height()-200),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()/2,height()*-.355),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()*.66,height()*.75),area(),body({isStatic:!0}),color(0,0,0),"solid"]),setGravity(1600)},v=D({background:[255,255,255],width:H,height:L,scale:1,pixelated:!0});I(v);y.init(v);y.addScene("test",C);y.startScene("test");
//# sourceMappingURL=index-Cn6ctac0.js.map
