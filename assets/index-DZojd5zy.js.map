{"version":3,"file":"index-DZojd5zy.js","sources":["../../src/utils/fullscreen.js","../../src/config.js","../../src/app.js","../../src/objects/rope.js","../../src/scenes/player.js","../../src/scenes/testing_scene.js","../../src/main.js"],"sourcesContent":["function resizeGame(kaplay) {\r\n  const gameCanvas = document.querySelector(\"canvas\");\r\n\r\n  const winWidth = window.innerWidth;\r\n  const winHeight = window.innerHeight;\r\n\r\n  const scaleX = Math.floor(winWidth / kaplay.width);\r\n  const scaleY = Math.floor(winHeight / kaplay.height);\r\n  const scale = Math.max(1, Math.min(scaleX, scaleY));\r\n\r\n  gameCanvas.style.width = kaplay.width * scale + \"px\";\r\n  gameCanvas.style.height = kaplay.height * scale + \"px\";\r\n  gameCanvas.style.imageRendering = \"pixelated\";\r\n  gameCanvas.style.position = \"absolute\";\r\n  gameCanvas.style.top = \"50%\";\r\n  gameCanvas.style.left = \"50%\";\r\n  gameCanvas.style.transform = \"translate(-50%, -50%)\";\r\n}\r\n\r\nfunction goFullscreen() {\r\n  const canvas = document.querySelector(\"canvas\");\r\n  if (canvas.requestFullscreen) {\r\n    canvas.requestFullscreen();\r\n  } else if (canvas.webkitRequestFullscreen) {\r\n    canvas.webkitRequestFullscreen();\r\n  }\r\n}\r\n\r\nexport function fullscreenHandler(kaplay) {\r\n  window.addEventListener(\"resize\", resizeGame(kaplay));\r\n  window.addEventListener(\"load\", resizeGame(kaplay));\r\n\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    if (e.key === \"f\") {\r\n      goFullscreen();\r\n    }\r\n  });\r\n}\r\n","export const GAME_WIDTH = 800;\r\nexport const GAME_HEIGHT = 450;\r\n\r\n// 16:9\r\n\r\nexport const COLORS = {\r\n  background: [39, 38, 36],\r\n  foreground: [255, 255, 255],\r\n};\r\n","const App = {\r\n  kaplayInstance: null,\r\n  currentScene: null,\r\n\r\n  init(kaplayInstance) {\r\n    this.kaplayInstance = kaplayInstance;\r\n  },\r\n\r\n  addScene(name, sceneFunc) {\r\n    if (!this.kaplayInstance) {\r\n      console.error(\"Kaplay instance не инициализирован\");\r\n      return;\r\n    }\r\n\r\n    this.kaplayInstance.scene(name, sceneFunc);\r\n  },\r\n\r\n  startScene(name) {\r\n    if (!this.kaplayInstance) {\r\n      console.error(\"Kaplay instance не инициализирован\");\r\n      return;\r\n    }\r\n\r\n    this.currentScene = name;\r\n    this.kaplayInstance.go(name);\r\n  },\r\n};\r\n\r\nexport default App;\r\n","export function createSwingRope(anchor, radius) {\r\n  let angle = Math.PI / 2; // 90° вниз\r\n  let angularVelocity = 0;\r\n  const gravity = 0.007; // сила притяжения (можно тюнить)\r\n  const damping = 0.995; // трение\r\n\r\n  let player = null;\r\n\r\n  function attach(entity) {\r\n    player = entity;\r\n    const dx = player.pos.x - anchor.x;\r\n    const dy = player.pos.y - anchor.y;\r\n    angle = Math.atan2(dy, dx);\r\n    angularVelocity = 0;\r\n  }\r\n\r\n  function applyImpulse(force) {\r\n    angularVelocity += force;\r\n  }\r\n\r\n  onCollide(\"player\", \"solid\", () => {\r\n    angularVelocity = -angularVelocity * 2;\r\n  });\r\n\r\n  function update(dt) {\r\n    if (!player) return;\r\n\r\n    const frameFactor = dt() * 60;\r\n\r\n    angularVelocity += gravity * Math.cos(angle) * frameFactor;\r\n    angularVelocity *= Math.pow(damping, frameFactor);\r\n    angle += angularVelocity * frameFactor;\r\n\r\n    player.pos.x = anchor.x + radius * Math.cos(angle);\r\n    player.pos.y = anchor.y + radius * Math.sin(angle);\r\n\r\n    player.vel.x = -radius * angularVelocity * Math.sin(angle) * frameFactor;\r\n    player.vel.y = radius * angularVelocity * Math.cos(angle) * frameFactor;\r\n  }\r\n\r\n  function drawRope() {\r\n    if (!player) return;\r\n    drawLine({\r\n      p1: anchor,\r\n      p2: player.pos,\r\n      width: 2,\r\n      color: [0, 0, 0],\r\n    });\r\n  }\r\n\r\n  function setAnchor(newAnchor) {\r\n    anchor = newAnchor;\r\n    if (player) {\r\n      const dx = player.pos.x - anchor.x;\r\n      const dy = player.pos.y - anchor.y;\r\n      angle = Math.atan2(dy, dx);\r\n      angularVelocity = 0;\r\n    }\r\n  }\r\n\r\n  return {\r\n    attach,\r\n    applyImpulse,\r\n    update,\r\n    setAnchor,\r\n    draw: drawRope,\r\n  };\r\n}\r\n","import { createSwingRope } from \"../objects/rope\";\r\n\r\nconst IMPULSE_FORCE = 500;\r\nconst JUMP_FORCE = -600;\r\nconst SPEED = 200;\r\nconst DRAG_ON_GROUND = 7;\r\n\r\nexport const spawnPlayer = () => {\r\n  loadSprite(\"hero_afk\", \"./sprites/hero-afk.png\", {\r\n    sliceX: 8,\r\n    sliceY: 1,\r\n    anims: {\r\n      afk: 0,\r\n      idle: { from: 0, to: 7, loop: true },\r\n    },\r\n  });\r\n\r\n  const player = add([\r\n    sprite(\"hero_afk\"),\r\n    pos(center()),\r\n    area(),\r\n    body(),\r\n    anchor(\"center\"),\r\n    color(0, 0, 0),\r\n    \"player\",\r\n  ]);\r\n\r\n  player.play(\"idle\");\r\n  console.log(getSprite(\"hero_afk\"));\r\n\r\n  player.lastDirection = Vec2.fromAngle(-45);\r\n\r\n  onKeyDown(\"left\", () => {\r\n    player.flipX = true;\r\n    player.move(-SPEED, 0);\r\n    player.lastDirection = -1;\r\n  });\r\n\r\n  onKeyDown(\"right\", () => {\r\n    player.flipX = false;\r\n    player.move(SPEED, 0);\r\n    player.lastDirection = 1;\r\n  });\r\n\r\n  onKeyPress(\"space\", () => {\r\n    if (player.isGrounded()) {\r\n      player.applyImpulse(vec2(0, JUMP_FORCE));\r\n    }\r\n  });\r\n\r\n  onKeyPress(\"x\", () => {\r\n    player.applyImpulse(vec2(IMPULSE_FORCE, 0));\r\n  });\r\n\r\n  onKeyPress(\"z\", () => {\r\n    player.applyImpulse(vec2(-IMPULSE_FORCE, 0));\r\n  });\r\n\r\n  player.onUpdate(() => {\r\n    if (player.vel.x >= 1 || player.vel.x <= -1) {\r\n      player.lastDirection = player.vel.x;\r\n      console.log(player.lastDirection);\r\n    }\r\n\r\n    if (player.isGrounded()) {\r\n      player.drag = DRAG_ON_GROUND;\r\n    } else {\r\n      player.drag = 0;\r\n    }\r\n  });\r\n\r\n  // wall\r\n  player.onCollide(\"solid\", () => {\r\n    console.log(\"collide!\");\r\n    shake(5);\r\n    player.vel = vec2(player.vel.x * -1, player.vel.y);\r\n  });\r\n\r\n  function hook() {\r\n    let updateRope = false;\r\n    const rope = createSwingRope(vec2(0, 0), 120);\r\n    rope.attach(player);\r\n\r\n    onKeyPress(\"up\", () => {\r\n      const ropePivot = calcPoint();\r\n      if (ropePivot == null) {\r\n        return;\r\n      }\r\n\r\n      rope.setAnchor(ropePivot);\r\n      updateRope = true;\r\n    });\r\n    onKeyPress(\"down\", () => {\r\n      if (updateRope != true) return;\r\n\r\n      updateRope = false;\r\n      let newDir = player.vel.unit().scale(400);\r\n      console.log(newDir);\r\n      player.applyImpulse(newDir);\r\n    });\r\n\r\n    onUpdate(() => {\r\n      if (updateRope) {\r\n        rope.update(dt);\r\n      }\r\n    });\r\n\r\n    onDraw(() => {\r\n      if (updateRope) {\r\n        rope.draw();\r\n      }\r\n    });\r\n  }\r\n\r\n  const calcPoint = () => {\r\n    let direction = Vec2.fromAngle(-45);\r\n    player.lastDirection > 0\r\n      ? (direction.x = direction.x)\r\n      : (direction.x = -direction.x);\r\n    let hit = raycast(player.pos, direction.scale(400), [\"player\"]);\r\n\r\n    if (hit) {\r\n      return hit.point;\r\n\r\n      drawCircle({\r\n        pos: pos,\r\n        radius: 16,\r\n        color: BLUE,\r\n      });\r\n\r\n      drawLine({\r\n        p1: player.pos,\r\n        p2: hitPos,\r\n        width: 2,\r\n        color: BLUE,\r\n      });\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  hook();\r\n\r\n  return player;\r\n};\r\n\r\n// onKeyPress(\"c\", () => {\r\n//     const hookDistance = 200;\r\n//     const hookAngle = -60;\r\n\r\n//     const hook = player.add([\r\n//       rect(10, 10),\r\n//       pos(player.renderArea().center()),\r\n//       rotate(hookAngle),\r\n//       timer(),\r\n//       animate(),\r\n//     ]);\r\n\r\n//     const hit = raycast(player.center, Vec2.fromAngle(hookAngle).scale(400), [\r\n//       \"player\",\r\n//     ]);\r\n\r\n//     if (hit) {\r\n//       const poz = hit.point;\r\n\r\n//       drawCircle({\r\n//         pos: poz,\r\n//         radius: 1,\r\n//         color: [255, 0, 0],\r\n//       });\r\n\r\n//       drawLine({\r\n//         p1: player.pos,\r\n//         p2: poz.add(hit.normal.scale(25)),\r\n//         width: 1,\r\n//         color: BLUE,\r\n//       });\r\n//     }\r\n\r\n//     hook.animate(\"width\", [hook.width, (hook.width = hookDistance)], {\r\n//       loops: 1,\r\n//       duration: 0.1,\r\n//       direction: \"forward\",\r\n//     });\r\n\r\n//     hook.wait(1, () => {\r\n//       destroy(hook);\r\n//     });\r\n//   });\r\n","import { spawnPlayer } from \"./player\";\r\n\r\nexport const test_scene = () => {\r\n  let player = spawnPlayer();\r\n\r\n  add([\r\n    rect(width(), 20),\r\n    pos(0, height() - 20),\r\n    area(),\r\n    body({ isStatic: true }),\r\n  ]);\r\n\r\n  add([\r\n    rect(width() / 2, 20),\r\n    pos(width() / 4, height() - 300),\r\n    area(),\r\n    body({ isStatic: true }),\r\n    \"solid\",\r\n  ]);\r\n\r\n  add([\r\n    rect(20, height() - 20),\r\n    pos(width() - 20, 0),\r\n    area(),\r\n    body({ isStatic: true }),\r\n    \"solid\",\r\n  ]);\r\n\r\n  add([\r\n    rect(20, height() - 20),\r\n    pos(0, 0),\r\n    area(),\r\n    body({ isStatic: true }),\r\n    \"solid\",\r\n  ]);\r\n\r\n  setGravity(1600);\r\n};\r\n","import kaplay from \"kaplay\";\nimport { fullscreenHandler } from \"./utils/fullscreen\";\nimport { GAME_WIDTH, GAME_HEIGHT } from \"./config.js\";\n\nimport App from \"./app.js\";\nimport { test_scene } from \"./scenes/testing_scene.js\";\n\nconst k = kaplay({\n  background: [39, 38, 36],\n  width: GAME_WIDTH,\n  height: GAME_HEIGHT,\n  scale: 1,\n  pixelated: true,\n});\n\nfullscreenHandler(k);\n\nApp.init(k);\n\nApp.addScene(\"test\", test_scene);\nApp.startScene(\"test\");\n\nk.onClick(() => k.addKaboom(k.mousePos()));\n"],"names":["resizeGame","kaplay","gameCanvas","winWidth","winHeight","scaleX","scaleY","scale","goFullscreen","canvas","fullscreenHandler","e","GAME_WIDTH","GAME_HEIGHT","App","kaplayInstance","name","sceneFunc","createSwingRope","anchor","radius","angle","angularVelocity","gravity","damping","player","attach","entity","dx","dy","applyImpulse","force","update","dt","frameFactor","drawRope","setAnchor","newAnchor","IMPULSE_FORCE","JUMP_FORCE","SPEED","DRAG_ON_GROUND","spawnPlayer","hook","updateRope","rope","ropePivot","calcPoint","newDir","direction","hit","test_scene","k"],"mappings":"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"}