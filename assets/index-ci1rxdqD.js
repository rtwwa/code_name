import{h as P}from"./kaplay-CpR_OpMc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();function A(t){const e=document.querySelector("canvas"),o=window.innerWidth,i=window.innerHeight,n=Math.floor(o/t.width),r=Math.floor(i/t.height),s=Math.max(1,Math.min(n,r));e.style.width=t.width*s+"px",e.style.height=t.height*s+"px",e.style.imageRendering="pixelated",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}function I(){const t=document.querySelector("canvas");t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function R(t){window.addEventListener("resize",A(t)),window.addEventListener("load",A(t)),document.addEventListener("keydown",e=>{e.key==="f"&&I()})}const H=800,_=450,c={background:[34,42,61],foreground:[237,242,226]},S={kaplayInstance:null,currentScene:null,init(t){this.kaplayInstance=t},addScene(t,e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(t,e)},startScene(t){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=t,this.kaplayInstance.go(t)}};function K(t,e){let i=!1,n=!1,r=null;const s=()=>{let u=vec2(t.lastDirection,0);const g=raycast(t.pos,u.scale(32),["player"]);return g?g.point:null},w=u=>{n=!0,i=!0,r=u.clone(),t.vel=vec2(0,0),t.gravity=0,shake(5)},y=()=>{n&&(n=!1,r=null,t.gravity=1,shake(1),t.vel=vec2(t.vel.x,-5))};onKeyPress("down",()=>{y()}),onKeyPress("up",()=>{n&&(y(),t.applyImpulse(vec2(0,e)))}),t.onUpdate(()=>{if(t.isGrounded()&&(i=!1),n&&r){t.pos=r.clone(),t.vel=vec2(0,0);return}if(!n&&!i&&!t.isGrounded()&&Math.abs(t.vel.x)>2){const u=s();u&&w(u)}})}const L=500;function G(t){let e=!1;const o=()=>{e!=!0&&(e=!0,t.applyImpulse(vec2(L*t.lastDirection,0)))};return t.onUpdate(()=>{t.isGrounded()&&(e=!1)}),onKeyPress("x",()=>{o()}),{hasDashed:e,useDash:o}}function T(t,e){let o=Math.PI/2,i=0;const n=.5,r=.995;let s=null;function w(a){s=a;const l=s.pos.x-t.x,d=s.pos.y-t.y;o=Math.atan2(d,l),i=0}function y(a){i+=a}function u(a){if(!s)return;const l=a()*60;i+=n*Math.cos(o)*l,i*=Math.pow(r,l),o+=i*l;const d=s.pos.x-t.x,f=s.pos.y-t.y,p=Math.sqrt(d*d+f*f);if(p!==e){const h=d/p,v=f/p;s.pos.x=t.x+h*e,s.pos.y=t.y+v*e;const b=s.vel.x*h+s.vel.y*v;s.vel.x-=b*h,s.vel.y-=b*v}}function g(){s&&drawLine({p1:t,p2:s.pos,width:2,color:rgb(c.foreground)})}function E(a){if(t=a,s){const l=s.pos.x-t.x,d=s.pos.y-t.y;o=Math.atan2(d,l),i=0}}function O(a){if(e=a,s){const l=s.pos.x-t.x,d=s.pos.y-t.y;o=Math.atan2(d,l),s.pos.x=t.x+Math.cos(o)*e,s.pos.y=t.y+Math.sin(o)*e;const f=Math.cos(o),p=Math.sin(o),h=s.vel.x*f+s.vel.y*p;s.vel.x-=h*f,s.vel.y-=h*p}}return{attach:w,applyImpulse:y,update:u,setAnchor:E,setRadius:O,draw:g}}const C=400,m=120;function F(t){const e=T(vec2(0,0),m);let o=!1;return e.attach(t),onKeyPress("z",()=>{if(o==!1){q(t,e)&&(o=!0);return}o=!1,N(t)}),onKeyPress("down",()=>{o==!0&&(o=!1)}),onUpdate(()=>{o&&e.update(dt)}),onDraw(()=>{o&&e.draw()}),{isHooked:()=>o}}const q=(t,e)=>{const o=U(t);if(o==null)return!1;e.setAnchor(o);const i=o.sub(t.pos).len();return i<m?e.setRadius(i):e.setRadius(m),!0},N=t=>{let e=Vec2.fromAngle(-45).scale(C);e.x=e.x*t.lastDirection,t.applyImpulse(e)},U=t=>{let e=Vec2.fromAngle(-45);t.lastDirection>0?e.x=e.x:e.x=-e.x;let o=raycast(t.pos,e.scale(m),["player"]);return o?o.point:null};function V(t){const e=getSprite("dust"),o=e.data.tex,i=e.data.frames[0];return add([pos(),particles({max:50,lifeTime:[.5,5],speed:[10,5],texture:o,quads:[i]},{direction:90,spread:20})])}const D=-600,k=200,W=7,x=c.foreground,X=t=>{loadSprite("hero","./sprites/all.png",{sliceX:8,sliceY:2,anims:{afk:0,idle:{from:0,to:7,loop:!0},walk:{from:8,to:14,loop:!0}}}),loadShader("tint",null,`
    precision mediump float;

    uniform float r;
    uniform float g;
    uniform float b;

    vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
        vec4 c = def_frag();

        return vec4(r,g,b,c.a);
    }
    `);const e=add([sprite("hero"),pos(t),area(),body(),anchor("center"),shader("tint",()=>({r:x.at(0)/255,g:x.at(1)/255,b:x.at(2)/255})),"player"]);return e.lastDirection=1,G(e),K(e,D),F(e),onKeyDown("left",()=>{e.flipX=!0,e.move(-k,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(k,0),e.lastDirection=1}),onKeyPress("up",()=>{e.isGrounded()&&e.applyImpulse(vec2(0,D))}),e.onUpdate(()=>{if(e.isGrounded()?e.drag=W:e.drag=0,e.isGrounded())if(isKeyDown("left")||isKeyDown("right")){if(e.curAnim()=="walk")return;e.play("walk")}else{if(e.curAnim()=="idle")return;e.play("idle")}else e.play("afk")}),loadSprite("dust","./sprites/dust.png").then(()=>{V()}),e},z=()=>{const t=vec2(width()/6+50,height()-200);let e=X(t);add([rect(width()*1.5,height()*1.5),pos(-100,-100),area(),opacity(0),"aliveZone"]),e.onCollideEnd("aliveZone",()=>{e.vel=Vec2.ZERO,e.pos=t}),add([rect(width()/3,20),pos(0,height()-20),area(),body({isStatic:!0}),color(c.foreground),"solid"]),add([rect(width()/3,20),pos(width()/3*2,height()-20),area(),body({isStatic:!0}),color(c.foreground),"solid"]),add([rect(width()/3,20),pos(width()/6,height()-200),area(),body({isStatic:!0}),color(c.foreground),"solid"]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),color(c.foreground),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),color(c.foreground),"solid"]),add([rect(20,height()-20),pos(width()/2,height()*-.355),area(),body({isStatic:!0}),color(c.foreground),"solid"]),add([rect(20,height()-20),pos(width()*.66,height()*.75),area(),body({isStatic:!0}),color(c.foreground),"solid"]),setGravity(1600)},M=P({background:[c.background],width:H,height:_,scale:1,pixelated:!0});R(M);S.init(M);S.addScene("test",z);S.startScene("test");const Y=document.querySelector("body");Y.style.backgroundColor=rgb(c.background);
//# sourceMappingURL=index-ci1rxdqD.js.map
