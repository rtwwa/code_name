{"version":3,"file":"index-CC-VKruD.js","sources":["../../src/utils/fullscreen.js","../../src/config.js","../../src/app.js","../../src/objects/enemies/spider.js","../../src/objects/enemies/turretAR.js","../../src/objects/gameManager.js","../../src/objects/mouse.js","../../src/objects/player/abilities/attack.js","../../src/objects/player/player.js","../../src/scenes/testing_scene.js","../../src/scenes/death.scene.js","../../src/utils/shaders.js","../../src/main.js","../../src/utils/background.js"],"sourcesContent":["function resizeGame(kaplay) {\r\n  const gameCanvas = document.querySelector(\"canvas\");\r\n\r\n  const winWidth = window.innerWidth;\r\n  const winHeight = window.innerHeight;\r\n\r\n  const scaleX = Math.floor(winWidth / kaplay.width);\r\n  const scaleY = Math.floor(winHeight / kaplay.height);\r\n  const scale = Math.max(1, Math.min(scaleX, scaleY));\r\n\r\n  gameCanvas.style.width = kaplay.width * scale + \"px\";\r\n  gameCanvas.style.height = kaplay.height * scale + \"px\";\r\n  gameCanvas.style.imageRendering = \"pixelated\";\r\n  gameCanvas.style.position = \"absolute\";\r\n  gameCanvas.style.top = \"50%\";\r\n  gameCanvas.style.left = \"50%\";\r\n  gameCanvas.style.transform = \"translate(-50%, -50%)\";\r\n}\r\n\r\nfunction goFullscreen() {\r\n  const canvas = document.querySelector(\"canvas\");\r\n  if (canvas.requestFullscreen) {\r\n    canvas.requestFullscreen();\r\n  } else if (canvas.webkitRequestFullscreen) {\r\n    canvas.webkitRequestFullscreen();\r\n  }\r\n}\r\n\r\nexport function fullscreenHandler(kaplay) {\r\n  window.addEventListener(\"resize\", resizeGame(kaplay));\r\n  window.addEventListener(\"load\", resizeGame(kaplay));\r\n\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    if (e.key === \"f\") {\r\n      goFullscreen();\r\n    }\r\n  });\r\n}\r\n","export const GAME_WIDTH = 800;\r\nexport const GAME_HEIGHT = 800;\r\n\r\n// 16:9\r\n\r\n// export const COLORS = {\r\n//   background: [56, 43, 38],\r\n//   foreground: [184, 194, 185],\r\n// };\r\n\r\nexport const DEF_COLORS = {\r\n  background: [34, 42, 61],\r\n  foreground: [237, 242, 226],\r\n  debug: [255, 0, 0],\r\n};\r\n\r\nexport const COLORS = {\r\n  background: [34, 42, 61],\r\n  foreground: [237, 242, 226],\r\n  debug: [255, 0, 0],\r\n};\r\n\r\nexport function setForegroundColor(newColor) {\r\n  COLORS.foreground = newColor;\r\n  const allObj = get(\"*\");\r\n\r\n  allObj.map((obj) => {\r\n    if (obj.color) obj.color = Color.fromArray(newColor);\r\n    if (obj.outline) obj.outline.color = Color.fromArray(newColor);\r\n  });\r\n}\r\n","const App = {\r\n  kaplayInstance: null,\r\n  currentScene: null,\r\n\r\n  init(kaplayInstance) {\r\n    this.kaplayInstance = kaplayInstance;\r\n  },\r\n\r\n  addScene(name, sceneFunc) {\r\n    if (!this.kaplayInstance) {\r\n      console.error(\"Kaplay instance не инициализирован\");\r\n      return;\r\n    }\r\n\r\n    this.kaplayInstance.scene(name, sceneFunc);\r\n  },\r\n\r\n  startScene(name) {\r\n    if (!this.kaplayInstance) {\r\n      console.error(\"Kaplay instance не инициализирован\");\r\n      return;\r\n    }\r\n\r\n    this.currentScene = name;\r\n    this.kaplayInstance.go(name);\r\n  },\r\n};\r\n\r\nexport default App;\r\n","import { COLORS } from \"../../config\";\r\n\r\nexport const SPIDER_STATS = {\r\n  size: 10,\r\n  speed: 200,\r\n  moveInterval: 1.5,\r\n  damage: 1,\r\n  aggroRange: 200,\r\n  travelRange: 200,\r\n  hp: 1,\r\n  deathPartsCount: 50,\r\n  deathPartsSpeed: [300, 10],\r\n  deathPartsLife: 0.4,\r\n  deathShake: 2,\r\n  deathScore: 10,\r\n};\r\n\r\nexport function spawnSpider(position, centerPos, radius, options = {}) {\r\n  const {\r\n    size = SPIDER_STATS.size,\r\n    speed = SPIDER_STATS.speed,\r\n    moveInterval = SPIDER_STATS.moveInterval,\r\n    damage = SPIDER_STATS.damage,\r\n    aggroRange = SPIDER_STATS.aggroRange,\r\n    travelRange = SPIDER_STATS.travelRange,\r\n    hp = SPIDER_STATS.hp,\r\n    deathPartsCount = SPIDER_STATS.deathPartsCount,\r\n    deathPartsSpeed = SPIDER_STATS.deathPartsSpeed,\r\n    deathPartsLife = SPIDER_STATS.deathPartsLife,\r\n    deathShake = SPIDER_STATS.deathShake,\r\n    deathScore = SPIDER_STATS.deathScore,\r\n  } = options;\r\n  let dist = position;\r\n\r\n  const spider = add([\r\n    circle(size),\r\n    pos(position),\r\n    color(COLORS.foreground),\r\n    area(),\r\n    body(),\r\n    health(hp),\r\n    anchor(\"center\"),\r\n    \"enemy\",\r\n    \"spider\",\r\n    {\r\n      damage,\r\n      speed,\r\n      size,\r\n    },\r\n  ]);\r\n\r\n  function newDist() {\r\n    const player = get(\"player\")[0];\r\n    if (player) {\r\n      const distance = spider.pos.dist(player.pos);\r\n\r\n      console.log(player.width);\r\n\r\n      if (distance < aggroRange && distance > player.width + size) {\r\n        dist = vec2(player.pos.x, player.pos.y);\r\n        spider.moveTo(dist, speed);\r\n        return;\r\n      }\r\n    }\r\n\r\n    dist = getRandomDist();\r\n\r\n    const distFromCenter = dist.dist(centerPos);\r\n    if (distFromCenter > radius - size) {\r\n      dist = center();\r\n    }\r\n  }\r\n\r\n  function getRandomDist() {\r\n    return vec2(\r\n      spider.pos.x + rand(-travelRange, travelRange),\r\n      spider.pos.y + rand(-travelRange, travelRange)\r\n    );\r\n  }\r\n\r\n  function moveHandler() {\r\n    spider.moveTo(dist, speed);\r\n  }\r\n\r\n  loop(moveInterval, () => {\r\n    newDist();\r\n  });\r\n\r\n  spider.onUpdate(() => {\r\n    // drawCircle({\r\n    //   pos: spider.pos,\r\n    //   radius: aggroRange,\r\n    //   fill: false,\r\n    //   outline: { color: rgb(COLORS.debug) },\r\n    // });\r\n\r\n    // drawCircle({\r\n    //   pos: centerPos,\r\n    //   radius: radius - spider.size * 2,\r\n    //   color: rgb(COLORS.debug),\r\n    //   outline: { color: rgb(COLORS.debug) },\r\n    // });\r\n\r\n    moveHandler();\r\n  });\r\n\r\n  spider.onDeath(() => {\r\n    const death = add([\r\n      pos(spider.pos),\r\n      particles(\r\n        {\r\n          max: deathPartsCount,\r\n          speed: deathPartsSpeed,\r\n          angle: [0, 360],\r\n          angularVelocity: [45, 90],\r\n          lifeTime: [deathPartsLife, deathPartsLife],\r\n          colors: [rgb(COLORS.foreground)],\r\n          texture: getSprite(\"deathParticlies\").data.tex,\r\n          quads: [getSprite(\"deathParticlies\").data.frames[0]],\r\n        },\r\n        {\r\n          lifetime: deathPartsLife,\r\n          rate: 0,\r\n          direction: 0,\r\n          spread: 180,\r\n        }\r\n      ),\r\n    ]);\r\n\r\n    death.emit(deathPartsCount);\r\n    shake(deathShake);\r\n    destroy(spider);\r\n\r\n    get(\"gameManager\")[0].addScore(deathScore);\r\n  });\r\n\r\n  return spider;\r\n}\r\n\r\nexport function setupSpiderLogic() {\r\n  onCollide(\"spider\", \"player\", (spider, player) => {\r\n    player.hurt(spider.damage);\r\n  });\r\n}\r\n","import { COLORS } from \"../../config\";\r\n\r\nexport async function loadTurret() {\r\n  // await loadSprite(\"turret\", \"./sprites/turret.png\");\r\n  await loadSprite(\"deathParticlies\", \"./sprites/dust.png\");\r\n}\r\n\r\nexport const TURRET_STATS = {\r\n  bulletCount: 12,\r\n  bulletSpeed: 150,\r\n  damage: 1,\r\n  shootInterval: 2,\r\n  size: 24,\r\n  bulletSize: 6,\r\n  deathPartsCount: 150,\r\n  deathPartsSpeed: [300, 10],\r\n  deathPartsLife: 0.4,\r\n  deathShake: 3,\r\n  deathScore: 30,\r\n};\r\n\r\nexport function spawnTurretAR(position, options = {}) {\r\n  const {\r\n    bulletCount = TURRET_STATS.bulletCount,\r\n    bulletSpeed = TURRET_STATS.bulletSpeed,\r\n    damage = TURRET_STATS.damage,\r\n    shootInterval = TURRET_STATS.shootInterval,\r\n    size = TURRET_STATS.size,\r\n    bulletSize = TURRET_STATS.bulletSize,\r\n    deathPartsCount = TURRET_STATS.deathPartsCount,\r\n    deathPartsSpeed = TURRET_STATS.deathPartsSpeed,\r\n    deathPartsLife = TURRET_STATS.deathPartsLife,\r\n    deathShake = TURRET_STATS.deathShake,\r\n    deathScore = TURRET_STATS.deathScore,\r\n  } = options;\r\n\r\n  const turret = add([\r\n    rect(size, size),\r\n    pos(position),\r\n    area(),\r\n    body(),\r\n    health(1),\r\n    color(COLORS.foreground),\r\n    anchor(\"center\"),\r\n    \"enemy\",\r\n    {\r\n      bulletCount,\r\n      bulletSpeed,\r\n      damage,\r\n      shootInterval,\r\n    },\r\n  ]);\r\n\r\n  function shootCircle() {\r\n    for (let i = 0; i < turret.bulletCount; i++) {\r\n      const angle = (i / turret.bulletCount) * Math.PI * 2;\r\n      const dir = vec2(Math.cos(angle), Math.sin(angle));\r\n\r\n      add([\r\n        circle(bulletSize),\r\n        pos(turret.pos),\r\n        color(COLORS.foreground),\r\n        area(),\r\n        \"bullet\",\r\n        { dir, speed: turret.bulletSpeed, damage: turret.damage },\r\n      ]);\r\n    }\r\n  }\r\n\r\n  const timer = loop(turret.shootInterval, () => {\r\n    shootCircle();\r\n  });\r\n\r\n  turret.onDeath(() => {\r\n    const death = add([\r\n      pos(turret.pos),\r\n      particles(\r\n        {\r\n          max: deathPartsCount,\r\n          speed: deathPartsSpeed,\r\n          angle: [0, 360],\r\n          angularVelocity: [45, 90],\r\n          lifeTime: [deathPartsLife, deathPartsLife],\r\n          colors: [rgb(COLORS.foreground)],\r\n          texture: getSprite(\"deathParticlies\").data.tex,\r\n          quads: [getSprite(\"deathParticlies\").data.frames[0]],\r\n        },\r\n        {\r\n          lifetime: deathPartsLife,\r\n          rate: 0,\r\n          direction: 0,\r\n          spread: 180,\r\n        }\r\n      ),\r\n    ]);\r\n\r\n    death.emit(deathPartsCount);\r\n    shake(deathShake);\r\n    timer.cancel();\r\n    destroy(turret);\r\n\r\n    get(\"gameManager\")[0].addScore(deathScore);\r\n  });\r\n\r\n  return turret;\r\n}\r\n\r\nexport function setupBulletLogic(destroyBulletFunc) {\r\n  onUpdate(\"bullet\", (b) => {\r\n    b.move(b.dir.scale(b.speed));\r\n\r\n    destroyBulletFunc(b);\r\n  });\r\n\r\n  onCollide(\"bullet\", \"player\", (bullet, player) => {\r\n    destroy(bullet);\r\n    player.hurt(bullet.damage);\r\n  });\r\n}\r\n","import { spawnSpider, SPIDER_STATS } from \"./enemies/spider\";\r\nimport { spawnTurretAR, TURRET_STATS } from \"./enemies/turretAR\";\r\n\r\nexport function createGameManager(player, centerPos, radius) {\r\n  const manager = add([\r\n    timer(),\r\n    { score: 0, difficulty: 1, spawnInterval: 3, events: {} },\r\n    \"gameManager\",\r\n  ]);\r\n\r\n  // 📌 Сюда ты можешь кидать очки\r\n  manager.addScore = (amount) => {\r\n    manager.score += amount;\r\n    updateDifficulty();\r\n\r\n    emit(\"scoreChanged\", manager.score);\r\n  };\r\n\r\n  function updateDifficulty() {\r\n    // Можно усложнять через ступени\r\n    manager.difficulty = 1 + Math.floor(manager.score / 50);\r\n\r\n    // И постепенно ускорять спавн\r\n    manager.spawnInterval = Math.max(0.5, 3 - manager.difficulty * 0.2);\r\n  }\r\n\r\n  function spawnEnemy() {\r\n    // Выбираем тип врага\r\n    const enemyType = chooseEnemyType();\r\n    const pos = randomPosInCircle(centerPos, radius);\r\n\r\n    if (enemyType === \"spider\") {\r\n      spawnSpider(pos, centerPos, radius, {\r\n        speed: SPIDER_STATS.speed + manager.difficulty * 5,\r\n      });\r\n    }\r\n    if (enemyType === \"turret\") {\r\n      spawnTurretAR(pos, {\r\n        bulletCount: TURRET_STATS.bulletCount + manager.difficulty / 3,\r\n        bulletSpeed: TURRET_STATS.bulletSpeed + manager.difficulty,\r\n        bulletSize: TURRET_STATS.bulletSize + manager.difficulty / 3,\r\n      });\r\n    }\r\n  }\r\n\r\n  function chooseEnemyType() {\r\n    // Чем сложнее игра, тем больше шанс на \"тяжёлых\" врагов\r\n    if (manager.difficulty < 3) return \"spider\";\r\n    return Math.random() < 0.7 ? \"spider\" : \"turret\";\r\n  }\r\n\r\n  function randomPosInCircle(centerPos, radius) {\r\n    let pos;\r\n    let tries = 0;\r\n    do {\r\n      const angle = Math.random() * Math.PI * 2;\r\n      const distance = Math.sqrt(Math.random()) * radius;\r\n      pos = vec2(\r\n        centerPos.x + Math.cos(angle) * distance,\r\n        centerPos.y + Math.sin(angle) * distance\r\n      );\r\n      tries++;\r\n      if (tries > 100) break;\r\n    } while (pos.dist(player.pos) < 150);\r\n\r\n    return pos;\r\n  }\r\n\r\n  function emit(eventName, data) {\r\n    const listeners = manager.events[eventName];\r\n    if (!listeners) return;\r\n    listeners.forEach((cb) => cb(data));\r\n  }\r\n\r\n  manager.onScoreChange = (callback) => {\r\n    if (!manager.events[\"scoreChanged\"]) manager.events[\"scoreChanged\"] = [];\r\n    manager.events[\"scoreChanged\"].push(callback);\r\n  };\r\n\r\n  // Запускаем цикл спавна\r\n  manager.loop(manager.spawnInterval, spawnEnemy);\r\n\r\n  return manager;\r\n}\r\n","import { COLORS } from \"../config\";\r\n\r\nconst Cursor = {\r\n  c: null,\r\n\r\n  async init() {\r\n    await loadSprite(\"crosshair\", \"./sprites/crosshair.png\");\r\n\r\n    this.c = add([\r\n      sprite(\"crosshair\"),\r\n      pos(center()),\r\n      color(COLORS.foreground),\r\n      anchor(\"center\"),\r\n      \"cursor\",\r\n    ]);\r\n\r\n    this.c.use(\r\n      shader(\"newTint\", () => ({\r\n        r: COLORS.foreground.at(0) / 255,\r\n        g: COLORS.foreground.at(1) / 255,\r\n        b: COLORS.foreground.at(2) / 255,\r\n      }))\r\n    );\r\n\r\n    setCursor(\"none\");\r\n\r\n    const self = this;\r\n    onUpdate(\"cursor\", (cursorObj) => {\r\n      cursorObj.pos = mousePos();\r\n    });\r\n  },\r\n\r\n  getCursorPos() {\r\n    return this.c ? vec2(this.c.pos) : null;\r\n  },\r\n};\r\n\r\nexport default Cursor;\r\n","import { COLORS } from \"../../../config\";\r\nimport Cursor from \"../../mouse\";\r\n\r\nconst DASH_COOLDOWN = 1.5;\r\nconst ATTACK_SPAWN_RADIUS = 40;\r\n\r\nexport async function initAttackAbility(player) {\r\n  const attackAbility = add([timer()]);\r\n\r\n  attackAbility.damage = 1;\r\n  attackAbility.maxDist = 150;\r\n  attackAbility.speed = 800;\r\n\r\n  let hasDashed = false;\r\n  let newDist = null;\r\n  let newDir = null;\r\n\r\n  // await loadSprite(\"attackEffect\", \"./sprites/AttackEffect.png\");\r\n\r\n  attackAbility.Attack = () => {\r\n    if (hasDashed == true) return;\r\n\r\n    hasDashed = true;\r\n    attackAbility.wait(DASH_COOLDOWN, () => {\r\n      hasDashed = false;\r\n    });\r\n\r\n    newDir = attackAbility.getAttackDir();\r\n    newDist = attackAbility.getAttackPos();\r\n  };\r\n\r\n  attackAbility.getAttackDir = () => {\r\n    const playerPos = player.pos;\r\n    const mousePos = Cursor.getCursorPos();\r\n    return mousePos.sub(playerPos).unit();\r\n  };\r\n\r\n  attackAbility.getAttackPos = () => {\r\n    return vec2(\r\n      player.pos.x + newDir.x * attackAbility.maxDist,\r\n      player.pos.y + newDir.y * attackAbility.maxDist\r\n    );\r\n  };\r\n\r\n  onMousePress(\"left\", () => {\r\n    attackAbility.Attack();\r\n  });\r\n\r\n  attackAbility.onUpdate(() => {\r\n    if (newDist != null) {\r\n      player.setInv(false);\r\n      player.canMove = false;\r\n      player.moveTo(newDist, attackAbility.speed);\r\n\r\n      if (player.getCollisions()[0]) {\r\n        const objs = player.getCollisions();\r\n\r\n        objs.map((obj) => {\r\n          if (obj.target.tags.includes(\"enemy\")) {\r\n            newDist = null;\r\n            player.canMove = true;\r\n\r\n            obj.target.hurt();\r\n\r\n            return;\r\n          }\r\n        });\r\n      }\r\n\r\n      player.setInvTime(0.1);\r\n\r\n      if (\r\n        newDist != null &&\r\n        newDist.x.toFixed(0) == player.pos.x.toFixed(0) &&\r\n        newDist.y.toFixed(0) == player.pos.y.toFixed(0)\r\n      ) {\r\n        newDist = null;\r\n        player.canMove = true;\r\n\r\n        // const attackObj = add([\r\n        //   circle(8),\r\n        //   pos(\r\n        //     player.pos.x + newDir.x * ATTACK_SPAWN_RADIUS,\r\n        //     player.pos.y + newDir.y * ATTACK_SPAWN_RADIUS\r\n        //   ),\r\n        //   color(COLORS.foreground),\r\n        //   area(),\r\n        //   anchor(\"center\"),\r\n        //   timer(),\r\n        //   \"playerAttack\",\r\n        // ]);\r\n\r\n        // attackObj.wait(1, () => {\r\n        //   destroy(attackObj);\r\n        // });\r\n      }\r\n    }\r\n  });\r\n\r\n  return attackAbility;\r\n}\r\n","import App from \"../../app\";\r\nimport { COLORS, DEF_COLORS, setForegroundColor } from \"../../config\";\r\nimport { initAttackAbility } from \"./abilities/attack\";\r\nimport { initHookAbility } from \"./abilities/hook\";\r\nimport { createFootstepEmitter } from \"./particles\";\r\n\r\nconst MAX_HEALTH = 5;\r\nconst SPEED = 300;\r\nconst INV_AFTER_HURT = 0.3;\r\n\r\nexport const spawnPlayer = async (position) => {\r\n  let frames = vec2(8, 3);\r\n  let canTakeDamage = true;\r\n\r\n  loadSprite(\"hero\", \"./sprites/all.png\", {\r\n    sliceX: frames.x,\r\n    sliceY: frames.y,\r\n    anims: {\r\n      afk: 0,\r\n      idle: { from: 0, to: 7, loop: true },\r\n      walk: { from: 8, to: 14, loop: true },\r\n    },\r\n  });\r\n\r\n  const playerSprite = await getSprite(\"hero\");\r\n\r\n  const player = add([\r\n    sprite(playerSprite),\r\n    health(MAX_HEALTH, MAX_HEALTH),\r\n    pos(position),\r\n    color(COLORS.foreground),\r\n    area({\r\n      shape: new Polygon([\r\n        vec2(-18, 12),\r\n        vec2(10, 12),\r\n        vec2(10, -20),\r\n        vec2(-18, -20),\r\n      ]),\r\n    }),\r\n    body(),\r\n    anchor(vec2(0.2, 0.5)),\r\n    timer(),\r\n    {\r\n      maxHeath: MAX_HEALTH,\r\n      health: MAX_HEALTH,\r\n      speed: SPEED,\r\n      invAfterHurt: INV_AFTER_HURT,\r\n    },\r\n    \"player\",\r\n  ]);\r\n\r\n  player.use(\r\n    shader(\"playerShader\", () => ({\r\n      r: player.color.r / 255,\r\n      g: player.color.g / 255,\r\n      b: player.color.b / 255,\r\n      h: 596 + (1 - player.hp() / player.maxHP()) * 1452,\r\n      texSize: vec2(playerSprite.tex.width, playerSprite.tex.height),\r\n      frameOffset: vec2(\r\n        playerSprite.frames[player.frame].x,\r\n        playerSprite.frames[player.frame].y\r\n      ),\r\n      frameSize: vec2(\r\n        playerSprite.frames[player.frame].w,\r\n        playerSprite.frames[player.frame].h\r\n      ),\r\n    }))\r\n  );\r\n\r\n  // TODO: for testing, delete it later\r\n  onKeyPress(\"space\", () => {\r\n    let allBullet = get(\"bullet\");\r\n\r\n    allBullet.map((obj) => {\r\n      obj.radius = obj.radius * 3;\r\n    });\r\n  });\r\n\r\n  // Player variables\r\n  player.canMove = true;\r\n  player.isMoving = false;\r\n\r\n  // Player movement\r\n  const keyMap = {\r\n    KeyW: \"up\",\r\n    KeyA: \"left\",\r\n    KeyS: \"down\",\r\n    KeyD: \"right\",\r\n  };\r\n\r\n  const pressed = {};\r\n\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    const action = keyMap[e.code];\r\n    if (action) pressed[action] = true;\r\n  });\r\n\r\n  document.addEventListener(\"keyup\", (e) => {\r\n    const action = keyMap[e.code];\r\n    if (action) pressed[action] = false;\r\n  });\r\n\r\n  function isActionDown(action) {\r\n    return !!pressed[action];\r\n  }\r\n\r\n  const moveHandler = () => {\r\n    if (!player.canMove) return;\r\n\r\n    let dirX = 0;\r\n    let dirY = 0;\r\n\r\n    if (isActionDown(\"left\")) dirX -= 1;\r\n    if (isActionDown(\"right\")) dirX += 1;\r\n    if (isActionDown(\"up\")) dirY -= 1;\r\n    if (isActionDown(\"down\")) dirY += 1;\r\n\r\n    let dir = vec2(dirX, dirY);\r\n    if (dir.len() > 0) {\r\n      dir = dir.unit();\r\n      player.lastDirection = dir;\r\n      player.move(dir.x * SPEED, dir.y * SPEED);\r\n      player.flipX = dir.x < 0;\r\n    }\r\n  };\r\n\r\n  // Abilities\r\n  const attackAbility = initAttackAbility(player);\r\n  // const attachAbility = initAttachAbility(player, JUMP_FORCE);\r\n  // const hookAbility = initHookAbility(player);\r\n\r\n  // Physics\r\n  player.onUpdate(() => {\r\n    moveHandler();\r\n\r\n    if (\r\n      (isActionDown(\"left\") ||\r\n        isActionDown(\"right\") ||\r\n        isActionDown(\"up\") ||\r\n        isActionDown(\"down\")) &&\r\n      player.canMove\r\n    ) {\r\n      player.isMoving = true;\r\n      if (player.curAnim() == \"walk\") return;\r\n\r\n      player.play(\"walk\");\r\n    } else {\r\n      player.isMoving = false;\r\n      if (player.curAnim() == \"idle\") return;\r\n\r\n      player.play(\"afk\");\r\n    }\r\n  });\r\n\r\n  // Damage\r\n  player.hurt = (amount) => {\r\n    if (!canTakeDamage) return;\r\n\r\n    player.setInvTime(INV_AFTER_HURT);\r\n\r\n    player.setHP(player.hp() - amount);\r\n    player.trigger(\"hurt\");\r\n  };\r\n\r\n  player.setInvTime = (seconds) => {\r\n    canTakeDamage = false;\r\n    player.wait(seconds, () => {\r\n      canTakeDamage = true;\r\n    });\r\n  };\r\n\r\n  player.setInv = (bool) => {\r\n    canTakeDamage = bool;\r\n  };\r\n\r\n  player.onHurt(() => {\r\n    if (player.hp() <= 0) return;\r\n\r\n    shake(4);\r\n\r\n    setForegroundColor([156, 23, 59]);\r\n\r\n    player.wait(0.3, () => {\r\n      setForegroundColor(DEF_COLORS.foreground);\r\n    });\r\n  });\r\n\r\n  // Death\r\n  player.onDeath(() => {\r\n    App.startScene(\"death\");\r\n  });\r\n\r\n  return player;\r\n};\r\n","import { COLORS } from \"../config\";\r\nimport { setupSpiderLogic, spawnSpider } from \"../objects/enemies/spider\";\r\nimport {\r\n  loadTurret,\r\n  setupBulletLogic,\r\n  spawnTurretAR,\r\n} from \"../objects/enemies/turretAR\";\r\nimport { createGameManager } from \"../objects/gameManager\";\r\nimport Cursor from \"../objects/mouse\";\r\nimport { spawnPlayer } from \"../objects/player/player\";\r\n\r\nexport const test_scene = async () => {\r\n  const PLAYER_START_POS = vec2(center().x, center().y * 1.7);\r\n\r\n  const player = await spawnPlayer(PLAYER_START_POS);\r\n  await Cursor.init();\r\n\r\n  const centerPos = vec2(width() / 2, height() / 2);\r\n  const radius = width() / 2 - 16;\r\n  const halfRadiusPlayerModel = 36;\r\n\r\n  add([\r\n    pos(centerPos),\r\n    circle(radius, { fill: false }),\r\n    outline(2, Color.fromArray(COLORS.foreground)),\r\n    \"border\",\r\n  ]);\r\n\r\n  player.onUpdate(() => {\r\n    const distFromCenter = player.pos.dist(centerPos);\r\n    if (distFromCenter > radius - halfRadiusPlayerModel) {\r\n      const dir = player.pos.sub(centerPos).unit();\r\n      player.pos = centerPos.add(dir.scale(radius - halfRadiusPlayerModel));\r\n    }\r\n  });\r\n\r\n  setupBulletLogic((bullet) => {\r\n    const distFromCenter = bullet.pos.dist(centerPos);\r\n    if (distFromCenter > radius - bullet.radius) {\r\n      destroy(bullet);\r\n    }\r\n  });\r\n\r\n  await loadTurret();\r\n  // spawnTurretAR(vec2(center().x, 150));\r\n  // spawnTurretAR(vec2(center().x, 200), { bulletCount: 24, bulletSpeed: 200 });\r\n\r\n  setupSpiderLogic();\r\n  // spawnSpider(center(), centerPos, radius);\r\n  const gameManager = createGameManager(player, centerPos, radius);\r\n\r\n  const scoreText = add([\r\n    text(get(\"gameManager\")[0].score, { font: \"Tiny\" }),\r\n    pos(20, 20),\r\n    layer(\"ui\"),\r\n    color(COLORS.foreground),\r\n  ]);\r\n\r\n  gameManager.onScoreChange(() => {\r\n    scoreText.text = gameManager.score;\r\n  });\r\n};\r\n","import App from \"../app\";\r\nimport { COLORS } from \"../config\";\r\n\r\nexport const death_scene = async (nextScene) => {\r\n  const centerPos = vec2(width() / 2, height() / 2);\r\n  const radius = width() / 2 - 16;\r\n\r\n  add([\r\n    pos(centerPos),\r\n    circle(radius, { fill: false }),\r\n    outline(2, Color.fromArray(COLORS.foreground)),\r\n  ]);\r\n\r\n  const scoreText = add([\r\n    text(\"You are dead!\\nPress space to restart\", {\r\n      font: \"Tiny\",\r\n      align: \"center\",\r\n    }),\r\n    color(COLORS.foreground),\r\n    pos(center()),\r\n    anchor(\"center\"),\r\n    layer(\"ui\"),\r\n    animate(),\r\n  ]);\r\n\r\n  onKeyPress(\"space\", () => {\r\n    App.startScene(\"test\");\r\n  });\r\n\r\n  scoreText.animate(\"scale\", [0, 1], {\r\n    duration: 0.5,\r\n    loops: 1,\r\n  });\r\n\r\n  return nextScene;\r\n};\r\n","export function initShaders() {\r\n  loadShader(\r\n    \"playerShader\",\r\n    null,\r\n    `\r\n  precision mediump float;\r\n\r\n  uniform float r;\r\n  uniform float g;\r\n  uniform float b;\r\n  uniform float h;\r\n  uniform vec2 texSize;\r\n  uniform vec2 frameOffset;\r\n  uniform vec2 frameSize;\r\n\r\n  vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\r\n      vec4 c = texture2D(tex, uv);\r\n\r\n      if (c.a < 0.01) {\r\n          return c;\r\n      }\r\n\r\n      vec2 offsetX = vec2(1.0 / texSize.x, 0.0);\r\n      vec2 offsetY = vec2(0.0, 1.0 / texSize.y);\r\n\r\n      float alphaUp    = texture2D(tex, uv + offsetY).a;\r\n      float alphaDown  = texture2D(tex, uv - offsetY).a;\r\n      float alphaLeft  = texture2D(tex, uv - offsetX).a;\r\n      float alphaRight = texture2D(tex, uv + offsetX).a;\r\n\r\n      if (alphaUp < 0.01 || alphaDown < 0.01 || alphaLeft < 0.01 || alphaRight < 0.01) {\r\n          return vec4(r, g, b, c.a);\r\n      }\r\n\r\n      vec2 pixelCoord = uv * texSize;\r\n      vec2 localPixel = pixelCoord - (frameOffset * texSize);\r\n      vec2 localUV = localPixel / frameSize; // 0..1 по фрейму\r\n\r\n      if (localUV.y <= h) {\r\n          return vec4(1.0, 0.0, 0.0, 0.0);\r\n      }\r\n\r\n      return vec4(r, g, b, c.a);\r\n      }\r\n      `\r\n  );\r\n\r\n  loadShader(\r\n    \"newTint\",\r\n    null,\r\n    `\r\n    precision mediump float;\r\n\r\n    uniform float r;\r\n    uniform float g;\r\n    uniform float b;\r\n\r\n    vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\r\n      vec4 c = def_frag();\r\n\r\n      return vec4(r, g, b, c.a);\r\n    }\r\n    `\r\n  );\r\n}\r\n","import kaplay from \"kaplay\";\r\nimport { fullscreenHandler } from \"./utils/fullscreen\";\r\nimport { GAME_WIDTH, GAME_HEIGHT, COLORS } from \"./config.js\";\r\n\r\nimport App from \"./app.js\";\r\nimport { test_scene } from \"./scenes/testing_scene.js\";\r\nimport { death_scene } from \"./scenes/death.scene.js\";\r\nimport { initShaders } from \"./utils/shaders.js\";\r\n\r\nconst k = kaplay({\r\n  background: [COLORS.background],\r\n  width: GAME_WIDTH,\r\n  height: GAME_HEIGHT,\r\n  scale: 1,\r\n  pixelated: true,\r\n});\r\n\r\nfullscreenHandler(k);\r\n\r\nloadFont(\"Tiny\", \"./fonts/Tiny5-Regular.ttf\");\r\ninitShaders();\r\n\r\nApp.init(k);\r\n\r\nApp.addScene(\"test\", test_scene);\r\nApp.addScene(\"death\", death_scene);\r\nApp.startScene(\"test\");\r\n","import { COLORS } from \"../config\";\r\n\r\nconst body = document.querySelector(\"body\");\r\n\r\nbody.style.backgroundColor = rgb(COLORS.background);\r\n"],"names":["resizeGame","kaplay","gameCanvas","winWidth","winHeight","scaleX","scaleY","scale","goFullscreen","canvas","fullscreenHandler","e","GAME_WIDTH","GAME_HEIGHT","DEF_COLORS","COLORS","setForegroundColor","newColor","obj","App","kaplayInstance","name","sceneFunc","SPIDER_STATS","spawnSpider","position","centerPos","radius","options","size","speed","moveInterval","damage","aggroRange","travelRange","hp","deathPartsCount","deathPartsSpeed","deathPartsLife","deathShake","deathScore","dist","spider","newDist","player","distance","getRandomDist","moveHandler","setupSpiderLogic","loadTurret","TURRET_STATS","spawnTurretAR","bulletCount","bulletSpeed","shootInterval","bulletSize","turret","shootCircle","i","angle","dir","timer","setupBulletLogic","destroyBulletFunc","b","bullet","createGameManager","manager","amount","updateDifficulty","emit","spawnEnemy","enemyType","chooseEnemyType","pos","randomPosInCircle","tries","eventName","data","listeners","cb","callback","Cursor","cursorObj","DASH_COOLDOWN","initAttackAbility","attackAbility","hasDashed","newDir","playerPos","MAX_HEALTH","SPEED","INV_AFTER_HURT","spawnPlayer","frames","canTakeDamage","playerSprite","keyMap","pressed","action","isActionDown","dirX","dirY","seconds","bool","test_scene","PLAYER_START_POS","halfRadiusPlayerModel","gameManager","scoreText","death_scene","nextScene","initShaders","k","body"],"mappings":"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"}