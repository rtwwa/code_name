import{h as E}from"./kaplay-CpR_OpMc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const t of i.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&r(t)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function b(o){const e=document.querySelector("canvas"),n=window.innerWidth,r=window.innerHeight,s=Math.floor(n/o.width),i=Math.floor(r/o.height),t=Math.max(1,Math.min(s,i));e.style.width=o.width*t+"px",e.style.height=o.height*t+"px",e.style.imageRendering="pixelated",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}function D(){const o=document.querySelector("canvas");o.requestFullscreen?o.requestFullscreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen()}function L(o){window.addEventListener("resize",b(o)),window.addEventListener("load",b(o)),document.addEventListener("keydown",e=>{e.key==="f"&&D()})}const O=800,k=450,M={kaplayInstance:null,currentScene:null,init(o){this.kaplayInstance=o},addScene(o,e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(o,e)},startScene(o){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=o,this.kaplayInstance.go(o)}};function R(o,e){let n=Math.PI/2,r=0;const s=.5,i=.995;let t=null;function a(l){t=l;const d=t.pos.x-o.x,u=t.pos.y-o.y;n=Math.atan2(u,d),r=0}function c(l){r+=l}function y(l){if(!t)return;const d=l()*60;r+=s*Math.cos(n)*d,r*=Math.pow(i,d),n+=r*d;const u=t.pos.x-o.x,p=t.pos.y-o.y,h=Math.sqrt(u*u+p*p);if(h!==e){const f=u/h,x=p/h;t.pos.x=o.x+f*e,t.pos.y=o.y+x*e;const S=t.vel.x*f+t.vel.y*x;t.vel.x-=S*f,t.vel.y-=S*x}}function g(){if(!t)return;drawLine({p1:o,p2:t.pos,width:2,color:[0,0,0]});const l=t.vel.unit().scale(40),d=t.pos.add(l);drawLine({p1:t.pos,p2:d,width:2,color:BLUE})}function m(l){if(o=l,t){const d=t.pos.x-o.x,u=t.pos.y-o.y;n=Math.atan2(u,d),r=0}}function I(l){if(e=l,t){const d=t.pos.x-o.x,u=t.pos.y-o.y;n=Math.atan2(u,d),t.pos.x=o.x+Math.cos(n)*e,t.pos.y=o.y+Math.sin(n)*e;const p=Math.cos(n),h=Math.sin(n),f=t.vel.x*p+t.vel.y*h;t.vel.x-=f*p,t.vel.y-=f*h}}return{attach:a,applyImpulse:c,update:y,setAnchor:m,setRadius:I,draw:g}}const K=500,_=-600,P=200,A=7,G=400,v=120,F=o=>{loadSprite("hero_afk","./sprites/hero-afk.png",{sliceX:8,sliceY:1,anims:{afk:0,idle:{from:0,to:7,loop:!0}}});const e=add([sprite("hero_afk"),pos(o),area(),body(),anchor("center"),color(0,0,0),"player"]);e.play("idle"),e.lastDirection=1;let n=!1,r=null;onKeyDown("left",()=>{e.flipX=!0,e.move(-P,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(P,0),e.lastDirection=1}),onKeyPress("up",()=>{(e.isGrounded()||n)&&(s(),e.applyImpulse(vec2(0,_)))}),onKeyPress("x",()=>{e.applyImpulse(vec2(K*e.lastDirection,0))}),e.onUpdate(()=>{e.isGrounded()?e.drag=A:e.drag=0,n&&r&&(e.pos=r.clone(),e.vel=vec2(0,0))}),e.onCollide("solid",a=>{!n&&Math.abs(e.vel.x)>2&&!e.isGrounded()&&(n=!0,r=e.pos,e.vel=vec2(0,0),e.gravity=0,shake(5))}),onKeyPress("down",()=>{s()});function s(){n&&(n=!1,r=null,e.gravity=1,shake(1),e.vel=vec2(e.vel.x,-5))}function i(){let a=!1;const c=R(vec2(0,0),v);c.attach(e),onKeyPress("z",()=>{if(a==!1){const g=t();if(g==null)return;c.setAnchor(g);const m=g.sub(e.pos).len();m<v?c.setRadius(m):c.setRadius(v),a=!0;return}a=!1;let y=Vec2.fromAngle(-45).scale(G);y.x=y.x*e.lastDirection,e.applyImpulse(y)}),onUpdate(()=>{a&&c.update(dt)}),onDraw(()=>{a&&c.draw()})}const t=()=>{let a=Vec2.fromAngle(-45);e.lastDirection>0?a.x=a.x:a.x=-a.x;let c=raycast(e.pos,a.scale(v),["player"]);return c?c.point:null};return i(),e},H=()=>{F(vec2(width()/6+50,height()-200)),add([rect(width()/3,20),pos(0,height()-20),area(),body({isStatic:!0}),color(0,0,0)]),add([rect(width()/3,20),pos(width()/3*2,height()-20),area(),body({isStatic:!0}),color(0,0,0)]),add([rect(width()/3,20),pos(width()/6,height()-200),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()/2,height()*-.355),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()*.66,height()*.75),area(),body({isStatic:!0}),color(0,0,0),"solid"]),setGravity(1600)},w=E({background:[255,255,255],width:O,height:k,scale:1,pixelated:!0});L(w);M.init(w);M.addScene("test",H);M.startScene("test");w.onClick(()=>w.addKaboom(w.mousePos()));
//# sourceMappingURL=index-Cd6TaXZj.js.map
