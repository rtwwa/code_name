import{h as x}from"./kaplay-CpR_OpMc.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function p(e){const o=document.querySelector("canvas"),i=window.innerWidth,t=window.innerHeight,n=Math.floor(i/e.width),s=Math.floor(t/e.height),r=Math.max(1,Math.min(n,s));o.style.width=e.width*r+"px",o.style.height=e.height*r+"px",o.style.imageRendering="pixelated",o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)"}function M(){const e=document.querySelector("canvas");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function P(e){window.addEventListener("resize",p(e)),window.addEventListener("load",p(e)),document.addEventListener("keydown",o=>{o.key==="f"&&M()})}const S=800,I=450,u={kaplayInstance:null,currentScene:null,init(e){this.kaplayInstance=e},addScene(e,o){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(e,o)},startScene(e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=e,this.kaplayInstance.go(e)}};function D(e,o){let i=Math.PI/2,t=0;const n=.007,s=.995;let r=null;function y(l){r=l;const c=r.pos.x-e.x,d=r.pos.y-e.y;i=Math.atan2(d,c),t=0}function g(l){t+=l}onCollide("player","solid",()=>{t=-t*2});function w(l){if(!r)return;const c=l()*60;t+=n*Math.cos(i)*c,t*=Math.pow(s,c),i+=t*c,r.pos.x=e.x+o*Math.cos(i),r.pos.y=e.y+o*Math.sin(i),r.vel.x=-o*t*Math.sin(i)*c,r.vel.y=o*t*Math.cos(i)*c}function m(){r&&drawLine({p1:e,p2:r.pos,width:2,color:[0,0,0]})}function v(l){if(e=l,r){const c=r.pos.x-e.x,d=r.pos.y-e.y;i=Math.atan2(d,c),t=0}}return{attach:y,applyImpulse:g,update:w,setAnchor:v,draw:m}}const f=500,b=-600,h=200,E=7,K=()=>{loadSprite("hero","./sprites/hero.png");const e=add([sprite("hero"),pos(center()),area(),body(),anchor("center"),color(0,0,0),"player"]);e.lastDirection=Vec2.fromAngle(-45),onKeyDown("left",()=>{e.flipX=!0,e.move(-h,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(h,0),e.lastDirection=1}),onKeyPress("space",()=>{e.isGrounded()&&e.applyImpulse(vec2(0,b))}),onKeyPress("x",()=>{e.applyImpulse(vec2(f,0))}),onKeyPress("z",()=>{e.applyImpulse(vec2(-f,0))}),e.onUpdate(()=>{(e.vel.x>=1||e.vel.x<=-1)&&(e.lastDirection=e.vel.x,console.log(e.lastDirection)),e.isGrounded()?e.drag=E:e.drag=0}),e.onCollide("solid",()=>{console.log("collide!"),shake(5),e.vel=vec2(e.vel.x*-1,e.vel.y)});function o(){let t=!1;const n=D(vec2(0,0),120);n.attach(e),onKeyPress("up",()=>{const s=i();s!=null&&(n.setAnchor(s),t=!0)}),onKeyPress("down",()=>{if(t!=!0)return;t=!1;let s=e.vel.unit().scale(400);console.log(s),e.applyImpulse(s)}),onUpdate(()=>{t&&n.update(dt)}),onDraw(()=>{t&&n.draw()})}const i=()=>{let t=Vec2.fromAngle(-45);e.lastDirection>0?t.x=t.x:t.x=-t.x;let n=raycast(e.pos,t.scale(400),["player"]);return n?n.point:null};return o(),e},L=()=>{K(),add([rect(width(),20),pos(0,height()-20),area(),body({isStatic:!0})]),add([rect(width()/2,20),pos(width()/4,height()-300),area(),body({isStatic:!0}),"solid"]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),"solid"]),setGravity(1600)},a=x({background:[39,38,36],width:S,height:I,scale:1,pixelated:!0});P(a);u.init(a);u.addScene("test",L);u.startScene("test");a.onClick(()=>a.addKaboom(a.mousePos()));
//# sourceMappingURL=index-DVX_RN61.js.map
