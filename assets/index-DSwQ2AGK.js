import{h as P}from"./kaplay-CpR_OpMc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();function S(t){const e=document.querySelector("canvas"),s=window.innerWidth,i=window.innerHeight,n=Math.floor(s/t.width),r=Math.floor(i/t.height),o=Math.max(1,Math.min(n,r));e.style.width=t.width*o+"px",e.style.height=t.height*o+"px",e.style.imageRendering="pixelated",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)"}function k(){const t=document.querySelector("canvas");t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function E(t){window.addEventListener("resize",S(t)),window.addEventListener("load",S(t)),document.addEventListener("keydown",e=>{e.key==="f"&&k()})}const H=800,K=450,x={kaplayInstance:null,currentScene:null,init(t){this.kaplayInstance=t},addScene(t,e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(t,e)},startScene(t){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=t,this.kaplayInstance.go(t)}};function O(t,e){let i=!1,n=!1,r=null;const o=()=>{let d=vec2(t.lastDirection,0);const y=raycast(t.pos,d.scale(32),["player"]);return y?y.point:null},w=d=>{n=!0,i=!0,r=d.clone(),t.vel=vec2(0,0),t.gravity=0,shake(5)},h=()=>{n&&(n=!1,r=null,t.gravity=1,shake(1),t.vel=vec2(t.vel.x,-5))};onKeyPress("down",()=>{h()}),onKeyPress("up",()=>{n&&(h(),t.applyImpulse(vec2(0,e)))}),t.onUpdate(()=>{if(t.isGrounded()&&(i=!1),n&&r){t.pos=r.clone(),t.vel=vec2(0,0);return}if(!n&&!i&&!t.isGrounded()&&Math.abs(t.vel.x)>2){const d=o();d&&w(d)}})}const G=500;function R(t){let e=!1;const s=()=>{e!=!0&&(e=!0,t.applyImpulse(vec2(G*t.lastDirection,0)))};return t.onUpdate(()=>{t.isGrounded()&&(e=!1)}),onKeyPress("x",()=>{s()}),{hasDashed:e,useDash:s}}function L(t,e){let s=Math.PI/2,i=0;const n=.5,r=.995;let o=null;function w(c){o=c;const a=o.pos.x-t.x,l=o.pos.y-t.y;s=Math.atan2(l,a),i=0}function h(c){i+=c}function d(c){if(!o)return;const a=c()*60;i+=n*Math.cos(s)*a,i*=Math.pow(r,a),s+=i*a;const l=o.pos.x-t.x,u=o.pos.y-t.y,f=Math.sqrt(l*l+u*u);if(f!==e){const p=l/f,m=u/f;o.pos.x=t.x+p*e,o.pos.y=t.y+m*e;const v=o.vel.x*p+o.vel.y*m;o.vel.x-=v*p,o.vel.y-=v*m}}function y(){o&&drawLine({p1:t,p2:o.pos,width:2,color:[0,0,0]})}function b(c){if(t=c,o){const a=o.pos.x-t.x,l=o.pos.y-t.y;s=Math.atan2(l,a),i=0}}function I(c){if(e=c,o){const a=o.pos.x-t.x,l=o.pos.y-t.y;s=Math.atan2(l,a),o.pos.x=t.x+Math.cos(s)*e,o.pos.y=t.y+Math.sin(s)*e;const u=Math.cos(s),f=Math.sin(s),p=o.vel.x*u+o.vel.y*f;o.vel.x-=p*u,o.vel.y-=p*f}}return{attach:w,applyImpulse:h,update:d,setAnchor:b,setRadius:I,draw:y}}const _=400,g=120;function F(t){const e=L(vec2(0,0),g);let s=!1;return e.attach(t),onKeyPress("z",()=>{if(s==!1){T(t,e)&&(s=!0);return}s=!1,q(t)}),onKeyPress("down",()=>{s==!0&&(s=!1)}),onUpdate(()=>{s&&e.update(dt)}),onDraw(()=>{s&&e.draw()}),{isHooked:()=>s}}const T=(t,e)=>{const s=N(t);if(s==null)return!1;e.setAnchor(s);const i=s.sub(t.pos).len();return i<g?e.setRadius(i):e.setRadius(g),!0},q=t=>{let e=Vec2.fromAngle(-45).scale(_);e.x=e.x*t.lastDirection,t.applyImpulse(e)},N=t=>{let e=Vec2.fromAngle(-45);t.lastDirection>0?e.x=e.x:e.x=-e.x;let s=raycast(t.pos,e.scale(g),["player"]);return s?s.point:null};function U(t){const e=getSprite("dust"),s=e.data.tex,i=e.data.frames[0];return add([pos(),particles({max:50,lifeTime:[.5,5],speed:[10,5],texture:s,quads:[i]},{direction:90,spread:20})])}const A=-600,D=200,C=7,V=t=>{loadSprite("hero","./sprites/all.png",{sliceX:8,sliceY:2,anims:{afk:0,idle:{from:0,to:7,loop:!0},walk:{from:8,to:14,loop:!0}}});const e=add([sprite("hero"),pos(t),area(),body(),anchor("center"),color(0,0,0),"player"]);return e.lastDirection=1,R(e),O(e,A),F(e),onKeyDown("left",()=>{e.flipX=!0,e.move(-D,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(D,0),e.lastDirection=1}),onKeyPress("up",()=>{e.isGrounded()&&e.applyImpulse(vec2(0,A))}),e.onUpdate(()=>{if(e.isGrounded()?e.drag=C:e.drag=0,e.isGrounded())if(isKeyDown("left")||isKeyDown("right")){if(e.curAnim()=="walk")return;e.play("walk")}else{if(e.curAnim()=="idle")return;e.play("idle")}else e.play("afk")}),loadSprite("dust","./sprites/dust.png").then(()=>{U()}),e},W=()=>{V(vec2(width()/6+50,height()-200)),add([rect(width()/3,20),pos(0,height()-20),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(width()/3,20),pos(width()/3*2,height()-20),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(width()/3,20),pos(width()/6,height()-200),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()/2,height()*-.355),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(width()*.66,height()*.75),area(),body({isStatic:!0}),color(0,0,0),"solid"]),setGravity(1600)},M=P({background:[255,255,255],width:H,height:K,scale:1,pixelated:!0});E(M);x.init(M);x.addScene("test",W);x.startScene("test");
//# sourceMappingURL=index-DSwQ2AGK.js.map
