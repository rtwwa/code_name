import{h as D}from"./kaplay-CpR_OpMc.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const t of i.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();function x(e){const n=document.querySelector("canvas"),r=window.innerWidth,s=window.innerHeight,o=Math.floor(r/e.width),i=Math.floor(s/e.height),t=Math.max(1,Math.min(o,i));n.style.width=e.width*t+"px",n.style.height=e.height*t+"px",n.style.imageRendering="pixelated",n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)"}function L(){const e=document.querySelector("canvas");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function O(e){window.addEventListener("resize",x(e)),window.addEventListener("load",x(e)),document.addEventListener("keydown",n=>{n.key==="f"&&L()})}const R=800,k=450,g={kaplayInstance:null,currentScene:null,init(e){this.kaplayInstance=e},addScene(e,n){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(e,n)},startScene(e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=e,this.kaplayInstance.go(e)}};function _(e,n){let r=Math.PI/2,s=0;const o=.5,i=.995;let t=null,d=!1;function M(l){t=l;const c=t.pos.x-e.x,a=t.pos.y-e.y;r=Math.atan2(a,c),s=0}function S(l){s+=l}onCollide("player","solid",()=>{d||(s=-s*1.5,d=!0),s=-s*.8});function I(l){if(!t)return;const c=l()*60;s+=o*Math.cos(r)*c,s*=Math.pow(i,c),r+=s*c;const a=t.pos.x-e.x,p=t.pos.y-e.y,u=Math.sqrt(a*a+p*p);if(u!==n){const f=a/u,w=p/u;t.pos.x=e.x+f*n,t.pos.y=e.y+w*n;const m=t.vel.x*f+t.vel.y*w;t.vel.x-=m*f,t.vel.y-=m*w}}function P(){if(!t)return;drawLine({p1:e,p2:t.pos,width:2,color:[0,0,0]});const l=t.vel.unit().scale(40),c=t.pos.add(l);drawLine({p1:t.pos,p2:c,width:2,color:BLUE})}function b(l){if(e=l,t){const c=t.pos.x-e.x,a=t.pos.y-e.y;r=Math.atan2(a,c),s=0,d=!1}}function E(l){if(n=l,t){const c=t.pos.x-e.x,a=t.pos.y-e.y;r=Math.atan2(a,c),t.pos.x=e.x+Math.cos(r)*n,t.pos.y=e.y+Math.sin(r)*n;const p=Math.cos(r),u=Math.sin(r),f=t.vel.x*p+t.vel.y*u;t.vel.x-=f*p,t.vel.y-=f*u}}return{attach:M,applyImpulse:S,update:I,setAnchor:b,setRadius:E,draw:P}}const K=500,A=-600,v=200,F=7,G=400,h=120,H=()=>{loadSprite("hero_afk","./sprites/hero-afk.png",{sliceX:8,sliceY:1,anims:{afk:0,idle:{from:0,to:7,loop:!0}}});const e=add([sprite("hero_afk"),pos(center()),area(),body(),anchor("center"),color(0,0,0),"player"]);e.play("idle"),e.lastDirection=Vec2.fromAngle(-45),onKeyDown("left",()=>{e.flipX=!0,e.move(-v,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(v,0),e.lastDirection=1}),onKeyPress("space",()=>{e.isGrounded()&&e.applyImpulse(vec2(0,A))}),onKeyPress("x",()=>{e.applyImpulse(vec2(K*e.lastDirection,0))}),e.onUpdate(()=>{e.isGrounded()?e.drag=F:e.drag=0}),e.onCollide("solid",()=>{(e.vel.x>2||e.vel.x<-2)&&shake(5),e.vel=vec2(e.vel.x*-1,e.vel.y)});function n(){let s=!1;const o=_(vec2(0,0),h);o.attach(e),onKeyPress("z",()=>{if(s==!1){const t=r();if(t==null)return;o.setAnchor(t);const d=t.sub(e.pos).len();d<h?o.setRadius(d):o.setRadius(h),s=!0;return}s=!1;let i=Vec2.fromAngle(-45).scale(G);i.x=i.x*e.lastDirection,e.applyImpulse(i)}),onUpdate(()=>{s&&o.update(dt)}),onDraw(()=>{s&&o.draw()})}const r=()=>{let s=Vec2.fromAngle(-45);e.lastDirection>0?s.x=s.x:s.x=-s.x;let o=raycast(e.pos,s.scale(h),["player"]);return o?o.point:null};return n(),e},q=()=>{H(),add([rect(width()/3,20),pos(0,height()-20),area(),body({isStatic:!0}),color(0,0,0)]),add([rect(width()/3,20),pos(width()/3*2,height()-20),area(),body({isStatic:!0}),color(0,0,0)]),add([rect(width()/2,20),pos(width()/4,height()-200),area(),body({isStatic:!0}),color(0,0,0)]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),color(0,0,0),"solid"]),setGravity(1600)},y=D({background:[255,255,255],width:R,height:k,scale:1,pixelated:!0});O(y);g.init(y);g.addScene("test",q);g.startScene("test");y.onClick(()=>y.addKaboom(y.mousePos()));
//# sourceMappingURL=index-CtgCOT1B.js.map
