import{h as M}from"./kaplay-CpR_OpMc.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const t of s.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&n(t)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();function p(e){const r=document.querySelector("canvas"),i=window.innerWidth,n=window.innerHeight,o=Math.floor(i/e.width),s=Math.floor(n/e.height),t=Math.max(1,Math.min(o,s));r.style.width=e.width*t+"px",r.style.height=e.height*t+"px",r.style.imageRendering="pixelated",r.style.position="absolute",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)"}function S(){const e=document.querySelector("canvas");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function P(e){window.addEventListener("resize",p(e)),window.addEventListener("load",p(e)),document.addEventListener("keydown",r=>{r.key==="f"&&S()})}const I=800,b=450,u={kaplayInstance:null,currentScene:null,init(e){this.kaplayInstance=e},addScene(e,r){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.kaplayInstance.scene(e,r)},startScene(e){if(!this.kaplayInstance){console.error("Kaplay instance не инициализирован");return}this.currentScene=e,this.kaplayInstance.go(e)}};function E(e,r){let i=Math.PI/2,n=0;const o=.007,s=.995;let t=null;function g(a){t=a;const l=t.pos.x-e.x,d=t.pos.y-e.y;i=Math.atan2(d,l),n=0}function m(a){n+=a}onCollide("player","solid",()=>{n=-n*1});function w(a){if(!t)return;t.vel.x>3?t.vel.x=3:t.vel.x=t.vel.x,t.vel.y>3?t.vel.x=3:t.vel.y=t.vel.y;const l=a()*60;n+=o*Math.cos(i)*l,n*=Math.pow(s,l),i+=n*l,t.pos.x=e.x+r*Math.cos(i),t.pos.y=e.y+r*Math.sin(i),t.vel.x=-r*n*Math.sin(i)*l,t.vel.y=r*n*Math.cos(i)*l}function v(){t&&drawLine({p1:e,p2:t.pos,width:2,color:[0,0,0]})}function x(a){if(e=a,t){const l=t.pos.x-e.x,d=t.pos.y-e.y;i=Math.atan2(d,l),n=0}}return{attach:g,applyImpulse:m,update:w,setAnchor:x,draw:v}}const f=500,O=-600,y=200,D=7,K=400,h=120,L=()=>{loadSprite("hero_afk","./sprites/hero-afk.png",{sliceX:8,sliceY:1,anims:{afk:0,idle:{from:0,to:7,loop:!0}}});const e=add([sprite("hero_afk"),pos(center()),area(),body(),anchor("center"),color(0,0,0),"player"]);e.play("idle"),e.lastDirection=Vec2.fromAngle(-45),onKeyDown("left",()=>{e.flipX=!0,e.move(-y,0),e.lastDirection=-1}),onKeyDown("right",()=>{e.flipX=!1,e.move(y,0),e.lastDirection=1}),onKeyPress("space",()=>{e.isGrounded()&&e.applyImpulse(vec2(0,O))}),onKeyPress("x",()=>{e.applyImpulse(vec2(f,0))}),onKeyPress("z",()=>{e.applyImpulse(vec2(-f,0))}),e.onUpdate(()=>{e.isGrounded()?e.drag=D:e.drag=0}),e.onCollide("solid",()=>{console.log("collide!"),shake(5),e.vel=vec2(e.vel.x*-1,e.vel.y)});function r(){let n=!1;const o=E(vec2(0,0),h);o.attach(e),onKeyPress("up",()=>{const s=i();s!=null&&(o.setAnchor(s),n=!0)}),onKeyPress("down",()=>{if(n!=!0)return;n=!1;let s=Vec2.fromAngle(-45).scale(K);s.x=s.x*e.lastDirection,console.log(s),e.applyImpulse(s)}),onUpdate(()=>{n&&o.update(dt)}),onDraw(()=>{n&&o.draw()})}const i=()=>{let n=Vec2.fromAngle(-45);e.lastDirection>0?n.x=n.x:n.x=-n.x;let o=raycast(e.pos,n.scale(h),["player"]);return o?o.point:null};return r(),e},_=()=>{L(),add([rect(width()/3,20),pos(0,height()-20),area(),body({isStatic:!0})]),add([rect(width()/3,20),pos(width()/3*2,height()-20),area(),body({isStatic:!0})]),add([rect(width()/2,20),pos(width()/4,height()-200),area(),body({isStatic:!0})]),add([rect(20,height()-20),pos(width()-20,0),area(),body({isStatic:!0}),"solid"]),add([rect(20,height()-20),pos(0,0),area(),body({isStatic:!0}),"solid"]),setGravity(1600)},c=M({background:[39,38,36],width:I,height:b,scale:1,pixelated:!0});P(c);u.init(c);u.addScene("test",_);u.startScene("test");c.onClick(()=>c.addKaboom(c.mousePos()));
//# sourceMappingURL=index-RPYx0ZhZ.js.map
